---
interface Props {
	class?: string;
}

const { class: className = "" } = Astro.props;
---

<button
	id="theme-toggle"
	class:list={[
		"flex size-10 items-center justify-center rounded-full text-gray-600 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",
		className,
	]}
	aria-label="テーマを切り替え"
>
	<!-- Sun icon (light mode) -->
	<svg
		id="theme-light-icon"
		xmlns="http://www.w3.org/2000/svg"
		viewBox="0 0 20 20"
		fill="currentColor"
		class="hidden size-5"
	>
		<path
			d="M10 2a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 10 2ZM10 15a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 10 15ZM10 7a3 3 0 1 0 0 6 3 3 0 0 0 0-6ZM15.657 5.404a.75.75 0 1 0-1.06-1.06l-1.061 1.06a.75.75 0 0 0 1.06 1.061l1.061-1.06ZM6.464 14.596a.75.75 0 1 0-1.06-1.06l-1.06 1.06a.75.75 0 0 0 1.06 1.06l1.06-1.06ZM18 10a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 18 10ZM5 10a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 5 10ZM14.596 15.657a.75.75 0 0 0 1.06-1.06l-1.06-1.061a.75.75 0 1 0-1.061 1.06l1.06 1.061ZM5.404 6.464a.75.75 0 0 0 1.06-1.06l-1.06-1.06a.75.75 0 1 0-1.061 1.06l1.06 1.06Z"
		/>
	</svg>
	<!-- Moon icon (dark mode) -->
	<svg
		id="theme-dark-icon"
		xmlns="http://www.w3.org/2000/svg"
		viewBox="0 0 20 20"
		fill="currentColor"
		class="hidden size-5"
	>
		<path
			fill-rule="evenodd"
			d="M7.455 2.004a.75.75 0 0 1 .26.77 7 7 0 0 0 9.958 7.967.75.75 0 0 1 1.067.853A8.5 8.5 0 1 1 6.647 1.921a.75.75 0 0 1 .808.083Z"
			clip-rule="evenodd"
		/>
	</svg>
</button>

<script is:inline>
	// Initialize theme from localStorage or system preference
	(function initTheme() {
		const theme = localStorage.getItem("theme");
		const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

		if (theme === "dark" || (!theme && prefersDark)) {
			document.documentElement.classList.add("dark");
		} else {
			document.documentElement.classList.remove("dark");
		}

		updateIcons();
	})();

	function updateIcons() {
		const isDark = document.documentElement.classList.contains("dark");
		const lightIcon = document.getElementById("theme-light-icon");
		const darkIcon = document.getElementById("theme-dark-icon");

		if (lightIcon && darkIcon) {
			// Show sun icon in dark mode (click to switch to light)
			// Show moon icon in light mode (click to switch to dark)
			if (isDark) {
				lightIcon.classList.remove("hidden");
				darkIcon.classList.add("hidden");
			} else {
				lightIcon.classList.add("hidden");
				darkIcon.classList.remove("hidden");
			}
		}
	}

	// Toggle theme on button click
	document.getElementById("theme-toggle")?.addEventListener("click", () => {
		const isDark = document.documentElement.classList.toggle("dark");
		localStorage.setItem("theme", isDark ? "dark" : "light");
		updateIcons();
	});

	// Listen for system preference changes
	window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
		if (!localStorage.getItem("theme")) {
			if (e.matches) {
				document.documentElement.classList.add("dark");
			} else {
				document.documentElement.classList.remove("dark");
			}
			updateIcons();
		}
	});
</script>
