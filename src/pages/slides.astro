---
import Layout from "../layouts/Layout.astro";
import { formatDate } from "../utils/date";

interface Slide {
	url: string;
	date: string;
	title: string;
	description: string;
}

let slides: Slide[] = [];
let error: string | null = null;

try {
	const res = await fetch("https://slides.ta93abe.com/slides.json", {
		signal: AbortSignal.timeout(10000),
	});
	if (res.ok) {
		const data = await res.json();
		slides = data.slides ?? [];
	} else {
		error = "スライドを取得できませんでした";
	}
} catch (e) {
	error = "スライドを取得できませんでした";
}
---

<Layout
  title="Slides | Portfolio"
  description="登壇やLTで使用したスライドの一覧です。"
>
  <main class="mx-auto max-w-4xl px-6 py-12">
    <h1 class="mb-4 text-4xl font-bold">Slides</h1>
    <p class="mb-12 text-gray-600">登壇やLTで使用したスライドの一覧です。</p>

    {
      error ? (
        <p class="text-gray-600">{error}</p>
      ) : slides.length === 0 ? (
        <p class="text-gray-600">スライドがありません。</p>
      ) : (
        <div class="space-y-6">
          {slides.map((slide) => (
            <a
              href={`https://slide.ta93abe.com${slide.url}`}
              target="_blank"
              rel="noopener noreferrer"
              class="group block rounded-lg border border-gray-200 p-6 transition-all hover:border-gray-300 hover:bg-gray-50 hover:shadow-sm"
            >
              <div class="mb-2 flex items-center gap-2 text-sm text-gray-500">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                  class="size-4"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5.75 2a.75.75 0 0 1 .75.75V4h7V2.75a.75.75 0 0 1 1.5 0V4h.25A2.75 2.75 0 0 1 18 6.75v8.5A2.75 2.75 0 0 1 15.25 18H4.75A2.75 2.75 0 0 1 2 15.25v-8.5A2.75 2.75 0 0 1 4.75 4H5V2.75A.75.75 0 0 1 5.75 2Zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75Z"
                    clip-rule="evenodd"
                  />
                </svg>
                <time>{slide.date}</time>
              </div>
              <h2 class="mb-2 text-xl font-bold group-hover:text-gray-600">
                {slide.title}
                <span class="ml-2 text-sm text-gray-400">→</span>
              </h2>
              {slide.description && (
                <p class="text-gray-600">{slide.description}</p>
              )}
            </a>
          ))}
        </div>
      )
    }
  </main>
</Layout>
