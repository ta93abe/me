---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import { formatDate } from "../../utils/date";

const books = await getCollection("books");
const statusLabels = {
	read: "読了",
	reading: "読書中",
	stacked: "積読",
};
const statusStyles = {
	read: "bg-emerald-100 text-emerald-800",
	reading: "bg-blue-100 text-blue-800",
	stacked: "bg-amber-100 text-amber-800",
};

const sortedBooks = books.sort((a, b) => {
	const aTime = a.data.finishedDate?.getTime() ?? 0;
	const bTime = b.data.finishedDate?.getTime() ?? 0;
	return bTime - aTime;
});
---

<Layout
	title="Bookshelf | Portfolio"
	description="読書記録と書評の一覧。読んだ本や積読のメモをまとめています。"
>
	<main class="mx-auto max-w-6xl px-6 py-12">
		<h1 class="mb-12 text-4xl font-bold">Bookshelf</h1>

		<div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
			{sortedBooks.map((book) => (
				<a
					href={`/bookshelf/${book.id}`}
					class="group block overflow-hidden rounded-lg border border-gray-200 transition-shadow hover:shadow-lg"
				>
					<div class="aspect-[3/4] overflow-hidden bg-gray-100">
						<Image
							src={book.data.coverImage}
							alt={`${book.data.title} cover`}
							class="h-full w-full object-cover transition-transform group-hover:scale-105"
						/>
					</div>
					<div class="p-4">
						<div class="mb-3 flex flex-wrap items-center gap-2">
							<span
								class={`rounded-full px-3 py-1 text-xs font-semibold ${statusStyles[book.data.status]}`}
							>
								{statusLabels[book.data.status]}
							</span>
							{book.data.category && (
								<span class="rounded-full bg-gray-100 px-3 py-1 text-xs">
									{book.data.category}
								</span>
							)}
						</div>
						<h2 class="mb-1 text-xl font-bold">{book.data.title}</h2>
						<p class="mb-2 text-sm text-gray-600">{book.data.author}</p>
						{book.data.finishedDate && (
							<p class="mb-2 text-xs text-gray-500">
								読了日: {formatDate(book.data.finishedDate)}
							</p>
						)}
						<p class="mb-3 text-sm text-gray-700">{book.data.excerpt}</p>
						<div class="flex flex-wrap gap-2">
							{book.data.tags.map((tag) => (
								<span class="rounded bg-gray-100 px-2 py-1 text-xs">
									{tag}
								</span>
							))}
						</div>
						{book.data.rating && (
							<p class="mt-3 text-xs text-gray-600">
								評価: {book.data.rating} / 5
							</p>
						)}
					</div>
				</a>
			))}
		</div>
	</main>
</Layout>
