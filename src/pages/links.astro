---
import { getCollection } from "astro:content";
import SnsLinks from "../components/SnsLinks.astro";
import Layout from "../layouts/Layout.astro";
import { formatDate } from "../utils/date";

// ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’å–å¾—
const [zennPosts, notePosts, podcastEpisodes, qiitaArticles] =
	await Promise.all([
		getCollection("zenn"),
		getCollection("note"),
		getCollection("podcast"),
		getCollection("qiita"),
	]);

// çµ±åˆå‹å®šç¾©
type FeedItem = {
	id: string;
	title: string;
	url: string;
	publishedAt: Date;
	excerpt: string;
	source: "Zenn" | "Note" | "Podcast" | "Qiita";
	icon: string;
	color: string;
};

// ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’çµ±åˆ
const allItems: FeedItem[] = [
	...zennPosts.map((post) => ({
		id: post.id,
		title: post.title,
		url: post.url,
		publishedAt: post.publishedAt,
		excerpt: post.excerpt,
		source: post.source,
		icon: "ğŸ“",
		color: "bg-blue-50 border-blue-200",
	})),
	...notePosts.map((post) => ({
		id: post.id,
		title: post.title,
		url: post.url,
		publishedAt: post.publishedAt,
		excerpt: post.excerpt,
		source: post.source,
		icon: "âœï¸",
		color: "bg-green-50 border-green-200",
	})),
	...podcastEpisodes.map((episode) => ({
		id: episode.id,
		title: episode.title,
		url: episode.url,
		publishedAt: episode.publishedAt,
		excerpt: episode.excerpt,
		source: episode.source,
		icon: "ğŸ™ï¸",
		color: "bg-purple-50 border-purple-200",
	})),
	...qiitaArticles.map((article) => ({
		id: article.id,
		title: article.title,
		url: article.url,
		publishedAt: article.createdAt,
		excerpt: "",
		source: "Qiita" as const,
		icon: "ğŸ’»",
		color: "bg-emerald-50 border-emerald-200",
	})),
];

// æ—¥ä»˜ãŒæœ‰åŠ¹ãªã‚¢ã‚¤ãƒ†ãƒ ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
const sortedItems = allItems
	.filter((item) => item.publishedAt && item.publishedAt instanceof Date)
	.sort((a, b) => b.publishedAt.getTime() - a.publishedAt.getTime());
---

<Layout
	title="Links | Portfolio"
	description="SNSãƒªãƒ³ã‚¯ã€ãƒ–ãƒ­ã‚°è¨˜äº‹ã€ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãªã©ã€ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã¾ã¨ã‚ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚"
>
	<main class="mx-auto max-w-4xl px-6 py-12">
		<div class="mb-12">
			<h1 class="mb-4 text-4xl font-bold">Links</h1>
			<p class="mb-8 text-gray-600">
				ãƒ–ãƒ­ã‚°è¨˜äº‹ã€ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€SNSãªã©ã€ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å½¢å¼ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
			</p>

			<!-- SNSãƒªãƒ³ã‚¯ -->
			<div class="mb-8">
				<h2 class="mb-4 text-xl font-bold">SNSãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢</h2>
				<SnsLinks />
			</div>
		</div>

		<!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ -->
		<div class="space-y-4">
			<h2 class="mb-6 text-2xl font-bold">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2>

			{sortedItems.length === 0 ? (
				<p class="text-gray-600">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
			) : (
				<div class="space-y-4">
					{sortedItems.map((item) => (
						<article
							class={`rounded-lg border p-6 transition-shadow hover:shadow-md ${item.color}`}
						>
							<a
								href={item.url}
								target="_blank"
								rel="noopener noreferrer"
								class="group block"
							>
								<div class="mb-2 flex items-center gap-2 text-sm text-gray-600">
									<span class="text-lg">{item.icon}</span>
									<span class="font-medium">{item.source}</span>
									<span>â€¢</span>
									<time>{formatDate(item.publishedAt)}</time>
								</div>
								<h3 class="mb-2 text-xl font-bold group-hover:text-gray-600">
									{item.title}
									<span class="ml-2 text-sm">â†’</span>
								</h3>
								{item.excerpt && (
									<p class="line-clamp-3 text-gray-700">
										{item.excerpt.substring(0, 200)}
										{item.excerpt.length > 200 && "..."}
									</p>
								)}
							</a>
						</article>
					))}
				</div>
			)}
		</div>

		<!-- ãƒ•ã‚£ãƒ¼ãƒ‰çµ±è¨ˆ -->
		<div class="mt-12 rounded-lg border border-gray-200 bg-gray-50 p-6">
			<h3 class="mb-4 text-lg font-bold">çµ±è¨ˆæƒ…å ±</h3>
			<div class="grid grid-cols-2 gap-4 md:grid-cols-4">
				<div class="text-center">
					<div class="text-2xl font-bold text-blue-600">{zennPosts.length}</div>
					<div class="text-sm text-gray-600">Zennè¨˜äº‹</div>
				</div>
				<div class="text-center">
					<div class="text-2xl font-bold text-green-600">{notePosts.length}</div>
					<div class="text-sm text-gray-600">Noteè¨˜äº‹</div>
				</div>
				<div class="text-center">
					<div class="text-2xl font-bold text-purple-600">{podcastEpisodes.length}</div>
					<div class="text-sm text-gray-600">Podcast</div>
				</div>
				<div class="text-center">
					<div class="text-2xl font-bold text-emerald-600">{qiitaArticles.length}</div>
					<div class="text-sm text-gray-600">Qiitaè¨˜äº‹</div>
				</div>
			</div>
		</div>
	</main>
</Layout>

<style>
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
